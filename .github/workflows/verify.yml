name: Verify dotfiles

on:
  push:
    paths:
      - '**'
  pull_request:

jobs:
  verify:
    runs-on: macos-latest

    steps:
      # 1. Check out your repo
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Prep Homebrew
      - name: Update Homebrew
        run: brew update

      # 3. Install everything in your Brewfile
      - name: Brewfile install
        run: brew bundle install --file=Brewfile

      # 4. Now verify (should pass)
      - name: Brewfile consistency check
        run: brew bundle check --file=Brewfile

      # 5. Dry‐run your installer
      - name: Dry‐run install.sh
        env:
          DOTFILES_DIR: ${{ github.workspace }}
        run: bash install.sh

      # 6. Dry‐run your updater
      - name: Dry‐run update.sh
        run: bash update.sh
